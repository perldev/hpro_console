<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Prolog console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
   
    <script type="text/javascript">
    var ws = new Object;
    var ws_trace = new Object;
    var history = new Array();
    var index = 0;
    HOST = "new.deepmemo.com";
    var editor;
    var LOADED = 0;
    WHOST = "ws://" + HOST+"/websocket/"; //"ws://hd-test-2.ceb.loc:10100";
    
    function listen(obj, E){
	  if(E.keyCode == 13 ){
		Code = $.trim(obj.value);

		
		if( Code.charAt(Code.length - 1) == "." ){
		
			  var Var  = "<p>| -? " + obj.value+"</p>";
			  var Var1 = obj.value;
			  Var1 = Var1.replace("\n","");
			  Var1 = Var1 + " ";
			  obj.value ="";
			  $("#sse").html("<p>| -? " + Var +"</p>");
			  history[$.trim(Var1)] = 1 ;
			  index = 0;
			  send("no.");    
			  send(Var1);
			  
//      	  	          $("#code").prop("disabled", true);     

		}
	  
	  }
	   if(E.keyCode == 38 ){//up
		  if(index == 0)
			return ;
		
		  if(index == 1){
		  
			document.getElementById("code").value = "";
			index = 0;
			return ;
		  }
		  
		  var i = 0;
		  for(key in history){
			  if(i+1 == index){
			   
			  	document.getElementById("code").value = key;

// 				$("#code").attr( { "value": key } );
				index = i;
				return ;

			  }
			  i++;
		  }
		  
	
	  }
	  if(E.keyCode == 40 ){//down
	  
		 var i = 1;
		 
		 for(key in history){
			  if(i-1 ==  index){
			  	document.getElementById("code").value = key;
// 				$("#code").attr(  "value", key  );
				index = i;
				return ;
			  }
			  i++;
			  
		  }
	  
	  
	  
	  }
	  
	  
    }

    
    

    

    function send(Code)
    {
    
	ws.send(Code);
	console.log('Message sent');
    }
    




    </script>
    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      #editor { 
		height: 800px;
/*		left: 600px;*/
		position: relative;
/*		right: 0;*/
/*		top: 100px;*/
		width: 800px;
      }
      #container_editor{
/*	  float: right;*/
	    display: none;
	    margin-left: 7em;
/*     margin-top: 100px; */
	    width: 800px;
      
      }
      #right_part{
	/*  float: left;
	  width: 600px;
	  margin-left:1em;*/
	  margin-top:2em;
	     margin-left: 7em;
	    width: 800px;
      
      }
      div.right{
	float:right
      }
      div.left{
	float:left
      }
      #trace{
	    width:800px;
	    display:none;
	    
/*	    float:right*/
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->


  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"  >
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
<!--             <span class="icon-bar"></span> -->
<!--             <span class="icon-bar"></span> -->
<!--             <span class="icon-bar"></span> -->
          </button>
          <a class="brand" href="#">Oracul</a>
          
          <div class="nav-collapse collapse">
            <ul class="nav">
<!--               <li class="active"><a href="#">Home</a></li> -->
<!--               <li><a href="#about">About</a></li> -->
<!--               <li><a href="#contact">Contact</a></li> -->
            </ul>\
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>


      <div id='console' style='margin-left: 7em;  width:800px;  margin-top: 2em; float:left'  >
		
		<div id="msgs" style="font-size: 16px;
				      width: 800px;
				      
				      ">
		<p class='console_p'> Using Prolog 0.6 </p>
		 <div style="float:left">
			    <input id="code"  style="border:1px solid #0088CC ; width:775px; height:20px;font-size:16px" 
				      onkeyup="listen(this,event)" />
			  </div> 
	      <br/><br/>
			<div id="sse" >
			   
			  
			  
			</div>
			
		</div>
      </div>


      
   
   
    </div>

    <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery1.9.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

<script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    $(document).ready(function() {
    
	
	Key = Math.random();
	// Handler for .ready() called.
	
	ws = new WebSocket(WHOST+Key);
	ws.onopen = function() {
	    console.log('Connected');
	};
	ws.onmessage = function (evt)
	{
	    var received_msg = evt.data;
	    console.log("Received: " + received_msg);
	    
	    var patt=/looking next \?/;
	    var result=patt.test(received_msg);
	    if(result){
		wait_answer = 1;
		
	    }
	    $("#sse").html("<p>" + received_msg +"</p>");
	    $("#code").focus();

	};
	ws.onclose = function()
	{
	    console.log('Connection closed');
	};
	ws_trace = new WebSocket(WHOST+"trace/" + Key);
	ws_trace.onopen = function() {
	    console.log('Connected');
	};
	ws_trace.onmessage = function (evt)
	{
	    var received_msg = evt.data;
	    console.log("Received: " + received_msg);
	    if(received_msg !="finish"){
	    
// 		$("#trace_input").prop("disabled", false);
		$("#trace_input").focus();    
	        $("<p>| -? " + received_msg +"</p>").insertBefore("#trace_sse");	    
	        scroll_trace();

	    }
	    

	};
	ws_trace.onclose = function()
	{
	    console.log('Connection closed');
	};
	
	
	
    });
    
</script>


</body>
</html>
