<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Prolog console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
   
    <script type="text/javascript">
    var ws = new Object;
    var ws_trace = new Object;
    var history = new Array();
    var index = 0;
    HOST = "new.deepmemo.com";
    var editor;
    var LOADED = 0;
    WHOST = "ws://" + HOST+"/websocket/"; //"ws://hd-test-2.ceb.loc:10100";
    function send_req(obj){
		 Code = $.trim(obj.value);	
		 var Var  = "<p>| -? " + obj.value+"</p>";
		 var Var1 = obj.value;
		 Var1 = Var1.replace("\n","");
		 Var1 = Var1 + " ";
		 obj.value ="";
		 $("#sse").html("<p>| -? " + Var +"</p>");
		 history[$.trim(Var1)] = 1 ;	  
		 index = 0;
		 send(Var1);
		 disable_run();     
    
    }
    function onFileLoaded(doc) {
      var string = doc.getModel().getRoot().get('text');
      string +="\n";      
      editor.setValue(string);
    } 
    function  update_editor(string){
	    editor.setValue(string);
    
    }
    
    function initializeModel(model){
    
	  return;
    }
    function my_after_auth(){
	  $("#authorizeButton").hide("fast");
    } 
   
    function but_search(){
	  var obj = document.getElementById("code");
	  if( $("#code").prop("disabled") )
	      return ;
	  Code = obj.value;
	  if(Code.charAt(Code.length-1) != "."){
			  Code +=".";
			 
	  }   
	  obj.value = Code;  
	  send_req(obj);
    
    }
    function listen(obj, E){
	  if(E.keyCode == 13 ){
		 Code = obj.value;
	  
		if(Code.charAt(Code.length-1) != "."){
			  Code +=".";
			 
	        } 
		obj.value = Code;
		send_req(obj);
	  
	  }
	  if(E.keyCode == 38 ){//up
		  if(index == 0)
			return ;
		
		  if(index == 1){
		  
			document.getElementById("code").value = "";
			index = 0;
			return ;
		  } 
		  var i = 0;
		  for(key in history){
			  if(i+1 == index){
			   
			  	document.getElementById("code").value = key;
 				$("#code").attr( { "value": key } );
				index = i;
				return ;

			  }
			  i++;
		  }
	  }
	  if(E.keyCode == 40 ){//down
	  
		 var i = 1;
		 
		 for(key in history){
			  if(i-1 ==  index){
			  	document.getElementById("code").value = key;
				$("#code").attr(  "value", key  );
				index = i;
				return ;
			  }
			  i++;
			  
		  }
	  
	  
	  
	  }
	  
	  
    }

    function disable_run(){
		  $("#code").prop("disabled", true);    
		  $("#search_but").hide("slow");
    
    }

    
    function enable_run(){
		  $("#code").prop("disabled", false);    
		  $("#search_but").show("slow");
		  $("#code").focus();
    
    }

    function send(Code)
    {
	hide_choose();
	send_txt = Code;

	ws.send(send_txt);
	console.log('Message sent');
    }
    function hide_choose(){
	
	$("#choose_menu").hide("fast");
    
    
    }
    function show_choose(){
	
	$("#choose_menu").show("fast");
    
    
    }



    </script>
    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      #editor { 
		height: 800px;
/*		left: 600px;*/
		position: relative;
/*		right: 0;*/
/*		top: 100px;*/
		width: 800px;
      }
      #container_editor{
/*	  float: right;*/
	    display: none;
	    margin-left: 7em;
/*     margin-top: 100px; */
	    width: 800px;
      
      }
      #right_part{
	/*  float: left;
	  width: 600px;
	  margin-left:1em;*/
	  margin-top:2em;
	     margin-left: 7em;
	    width: 800px;
      
      }
      div.right{
	float:right
      }
      div.left{
	float:left
      }
      #trace{
	    width:800px;
	    display:none;
	    
/*	    float:right*/
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->


  </head>

  <body>
  <div class="container"  >
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
      <div class="container"  >
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          </button>
          <a class="brand" href="#">PocketOracle</a>
          
          <div class="nav-collapse collapse" style='float:left' >
            <ul class="nav">
            <a class="btn btn-success pull-right greenbtn" href="/index.html">Queue</a>
            </ul>
          </div><!--/.nav-collapse -->
          
          <div class="nav-collapse collapse" style='float:right' >
            <ul class="nav">
            <a class="btn btn-success pull-right greenbtn" href="/console.html"> Make your own </a>
	    </ul>
          </div>
          
          <div class="nav-collapse collapse" style='float:right' >
            <ul class="nav">
	    <a class="btn btn-success pull-right greenbtn" href="/dev_help.html"> Developer SDK</a> 
	    </ul>
          </div>
	  
	  <div class="nav-collapse collapse" style='float:right' >
            <ul class="nav">
<!--	    <button class="btn  pull-right greenbtn" id='authorizeButton' href="javascript:startRealtime()"> Sig in via Google</button> -->
	    </ul>
          </div>
      
   
   
        </div>
        </div>
      </div>
    </div>


      <div id='console' style='  margin-left: 13em;  width:800px;  margin-top: 2em; float:left'  >
		
		<div id="msgs" style="font-size: 16px;
				      width: 800px;
				      
				      ">
		<p class='console_p'> Using Prolog 0.6 </p>
		 <div style="float:left">
			    <input id="code"  style="border:1px solid #0088CC ; width:740px; height:20px;font-size:16px" 
				      onkeyup="listen(this,event)" /> 
			  </div> 
	      <br/><br/>
			<div id="sse" >
			   
			  
			  
			</div>
			<div id='choose_menu' style='display:none; float:left;width:20em'>
			 <a class="btn btn-danger pull-left" href="javascript:send('no.')"> No </a>
			 <a class="btn btn-success pull-right" href="javascript:send('yes.')"> Yes </a>

			</div>
		      <div id="search_but" style='float:left;margin-left:20em'> <a class="btn pull-right" href="javascript:but_search()"> Queue </a>  </div>

			
		</div>
      </div>


      
      
   
    </div>

    <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery1.9.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/realtime-client-utils.js"></script>
    <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>

<script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    $(document).ready(function() {
	  $("#code").prop("disabled", false);    
	
	Key = Math.random();
	// Handler for .ready() called.
	
	ws = new WebSocket(WHOST+Key);
	ws.onopen = function() {
	    console.log('Connected');
	};
	ws.onmessage = function (evt)
	{
	    var received_msg = evt.data;
	    console.log("Received: " + received_msg);
	    
	    var patt=/looking next \?/;
	    
	    var result=patt.test(received_msg);
	    if(result){
		wait_answer = 1;
		show_choose();
		
	    }else{
		  enable_run();
		  
		
	    }
	    $("#sse").html("<p>" + received_msg +"</p>");
	    


	};
	ws.onclose = function()
	{
	    console.log('Connection closed');
	};
	ws_trace = new WebSocket(WHOST+"trace/" + Key);
	ws_trace.onopen = function() {
	    console.log('Connected');
	};
	ws_trace.onmessage = function (evt)
	{
	    var received_msg = evt.data;
	    console.log("Received: " + received_msg);
	    if(received_msg !="finish"){
	    
// 		$("#trace_input").prop("disabled", false);
		$("#trace_input").focus();    
	        $("<p>| -? " + received_msg +"</p>").insertBefore("#trace_sse");	    
	        scroll_trace();

	    }
	    

	};
	ws_trace.onclose = function()
	{
	    console.log('Connection closed');
	};
	
	
	
    });
    var realtimeOptions = {
      /**
       * Client ID from the APIs Console.
       */
      clientId: '768399903870.apps.googleusercontent.com',

      /**
       * The ID of the button to click to authorize. Must be a DOM element ID.
       */
      authButtonElementId: 'authorizeButton',

      /**
       * Function to be called when a Realtime model is first created.
       */
      initializeModel: initializeModel,

      /**
       * Autocreate files right after auth automatically.
       */
      autoCreate: false,

      /**
       * Autocreate files right after auth automatically.
       */
       defaultTitle: "New  Prolog Code",

      /**
       * Function to be called every time a Realtime file is loaded.
       */
      onFileLoaded: onFileLoaded
    };

    /**
     * Start the Realtime loader with the options.
     */
     var realtimeLoader;
    function startRealtime() {
      realtimeLoader = new rtclient.RealtimeLoader(realtimeOptions);
      realtimeLoader.start(my_after_auth);
    }
    
</script>


</body>
</html>
